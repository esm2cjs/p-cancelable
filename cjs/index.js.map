{
  "version": 3,
  "sources": ["../esm/index.js"],
  "sourcesContent": ["export class CancelError extends Error {\n\tconstructor(reason) {\n\t\tsuper(reason || 'Promise was canceled');\n\t\tthis.name = 'CancelError';\n\t}\n\n\tget isCanceled() {\n\t\treturn true;\n\t}\n}\n\nconst promiseState = Object.freeze({\n\tpending: Symbol('pending'),\n\tcanceled: Symbol('canceled'),\n\tresolved: Symbol('resolved'),\n\trejected: Symbol('rejected'),\n});\n\nexport default class PCancelable {\n\tstatic fn(userFunction) {\n\t\treturn (...arguments_) => new PCancelable((resolve, reject, onCancel) => {\n\t\t\targuments_.push(onCancel);\n\t\t\tuserFunction(...arguments_).then(resolve, reject);\n\t\t});\n\t}\n\n\t#cancelHandlers = [];\n\t#rejectOnCancel = true;\n\t#state = promiseState.pending;\n\t#promise;\n\t#reject;\n\n\tconstructor(executor) {\n\t\tthis.#promise = new Promise((resolve, reject) => {\n\t\t\tthis.#reject = reject;\n\n\t\t\tconst onResolve = value => {\n\t\t\t\tif (this.#state !== promiseState.canceled || !onCancel.shouldReject) {\n\t\t\t\t\tresolve(value);\n\t\t\t\t\tthis.#setState(promiseState.resolved);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst onReject = error => {\n\t\t\t\tif (this.#state !== promiseState.canceled || !onCancel.shouldReject) {\n\t\t\t\t\treject(error);\n\t\t\t\t\tthis.#setState(promiseState.rejected);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst onCancel = handler => {\n\t\t\t\tif (this.#state !== promiseState.pending) {\n\t\t\t\t\tthrow new Error(`The \\`onCancel\\` handler was attached after the promise ${this.#state.description}.`);\n\t\t\t\t}\n\n\t\t\t\tthis.#cancelHandlers.push(handler);\n\t\t\t};\n\n\t\t\tObject.defineProperties(onCancel, {\n\t\t\t\tshouldReject: {\n\t\t\t\t\tget: () => this.#rejectOnCancel,\n\t\t\t\t\tset: boolean => {\n\t\t\t\t\t\tthis.#rejectOnCancel = boolean;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\texecutor(onResolve, onReject, onCancel);\n\t\t});\n\t}\n\n\t// eslint-disable-next-line unicorn/no-thenable\n\tthen(onFulfilled, onRejected) {\n\t\treturn this.#promise.then(onFulfilled, onRejected);\n\t}\n\n\tcatch(onRejected) {\n\t\treturn this.#promise.catch(onRejected);\n\t}\n\n\tfinally(onFinally) {\n\t\treturn this.#promise.finally(onFinally);\n\t}\n\n\tcancel(reason) {\n\t\tif (this.#state !== promiseState.pending) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setState(promiseState.canceled);\n\n\t\tif (this.#cancelHandlers.length > 0) {\n\t\t\ttry {\n\t\t\t\tfor (const handler of this.#cancelHandlers) {\n\t\t\t\t\thandler();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.#reject(error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#rejectOnCancel) {\n\t\t\tthis.#reject(new CancelError(reason));\n\t\t}\n\t}\n\n\tget isCanceled() {\n\t\treturn this.#state === promiseState.canceled;\n\t}\n\n\t#setState(state) {\n\t\tif (this.#state === promiseState.pending) {\n\t\t\tthis.#state = state;\n\t\t}\n\t}\n}\n\nObject.setPrototypeOf(PCancelable.prototype, Promise.prototype);\n"],
  "mappings": "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",
  "names": []
}
