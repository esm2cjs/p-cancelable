{
  "version": 3,
  "sources": ["../esm/index.js"],
  "sourcesContent": ["export class CancelError extends Error {\n\tconstructor(reason) {\n\t\tsuper(reason || 'Promise was canceled');\n\t\tthis.name = 'CancelError';\n\t}\n\n\tget isCanceled() {\n\t\treturn true;\n\t}\n}\n\n// TODO: Use private class fields when ESLint 8 is out.\n\nexport default class PCancelable {\n\tstatic fn(userFunction) {\n\t\treturn (...arguments_) => {\n\t\t\treturn new PCancelable((resolve, reject, onCancel) => {\n\t\t\t\targuments_.push(onCancel);\n\t\t\t\t// eslint-disable-next-line promise/prefer-await-to-then\n\t\t\t\tuserFunction(...arguments_).then(resolve, reject);\n\t\t\t});\n\t\t};\n\t}\n\n\tconstructor(executor) {\n\t\tthis._cancelHandlers = [];\n\t\tthis._isPending = true;\n\t\tthis._isCanceled = false;\n\t\tthis._rejectOnCancel = true;\n\n\t\tthis._promise = new Promise((resolve, reject) => {\n\t\t\tthis._reject = reject;\n\n\t\t\tconst onResolve = value => {\n\t\t\t\tif (!this._isCanceled || !onCancel.shouldReject) {\n\t\t\t\t\tthis._isPending = false;\n\t\t\t\t\tresolve(value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst onReject = error => {\n\t\t\t\tthis._isPending = false;\n\t\t\t\treject(error);\n\t\t\t};\n\n\t\t\tconst onCancel = handler => {\n\t\t\t\tif (!this._isPending) {\n\t\t\t\t\tthrow new Error('The `onCancel` handler was attached after the promise settled.');\n\t\t\t\t}\n\n\t\t\t\tthis._cancelHandlers.push(handler);\n\t\t\t};\n\n\t\t\tObject.defineProperties(onCancel, {\n\t\t\t\tshouldReject: {\n\t\t\t\t\tget: () => this._rejectOnCancel,\n\t\t\t\t\tset: boolean => {\n\t\t\t\t\t\tthis._rejectOnCancel = boolean;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\texecutor(onResolve, onReject, onCancel);\n\t\t});\n\t}\n\n\tthen(onFulfilled, onRejected) {\n\t\t// eslint-disable-next-line promise/prefer-await-to-then\n\t\treturn this._promise.then(onFulfilled, onRejected);\n\t}\n\n\tcatch(onRejected) {\n\t\t// eslint-disable-next-line promise/prefer-await-to-then\n\t\treturn this._promise.catch(onRejected);\n\t}\n\n\tfinally(onFinally) {\n\t\t// eslint-disable-next-line promise/prefer-await-to-then\n\t\treturn this._promise.finally(onFinally);\n\t}\n\n\tcancel(reason) {\n\t\tif (!this._isPending || this._isCanceled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isCanceled = true;\n\n\t\tif (this._cancelHandlers.length > 0) {\n\t\t\ttry {\n\t\t\t\tfor (const handler of this._cancelHandlers) {\n\t\t\t\t\thandler();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis._reject(error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this._rejectOnCancel) {\n\t\t\tthis._reject(new CancelError(reason));\n\t\t}\n\t}\n\n\tget isCanceled() {\n\t\treturn this._isCanceled;\n\t}\n}\n\nObject.setPrototypeOf(PCancelable.prototype, Promise.prototype);\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAO,MAAM,oBAAoB,MAAM;AAAA,EACtC,YAAY,QAAQ;AACnB,UAAM,UAAU,sBAAsB;AACtC,SAAK,OAAO;AAAA,EACb;AAAA,EAEA,IAAI,aAAa;AAChB,WAAO;AAAA,EACR;AACD;AAIA,MAAO,YAA0B;AAAA,EAChC,OAAO,GAAG,cAAc;AACvB,WAAO,IAAI,eAAe;AACzB,aAAO,IAAI,YAAY,CAAC,SAAS,QAAQ,aAAa;AACrD,mBAAW,KAAK,QAAQ;AAExB,qBAAa,GAAG,UAAU,EAAE,KAAK,SAAS,MAAM;AAAA,MACjD,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAEA,YAAY,UAAU;AACrB,SAAK,kBAAkB,CAAC;AACxB,SAAK,aAAa;AAClB,SAAK,cAAc;AACnB,SAAK,kBAAkB;AAEvB,SAAK,WAAW,IAAI,QAAQ,CAAC,SAAS,WAAW;AAChD,WAAK,UAAU;AAEf,YAAM,YAAY,WAAS;AAC1B,YAAI,CAAC,KAAK,eAAe,CAAC,SAAS,cAAc;AAChD,eAAK,aAAa;AAClB,kBAAQ,KAAK;AAAA,QACd;AAAA,MACD;AAEA,YAAM,WAAW,WAAS;AACzB,aAAK,aAAa;AAClB,eAAO,KAAK;AAAA,MACb;AAEA,YAAM,WAAW,aAAW;AAC3B,YAAI,CAAC,KAAK,YAAY;AACrB,gBAAM,IAAI,MAAM,gEAAgE;AAAA,QACjF;AAEA,aAAK,gBAAgB,KAAK,OAAO;AAAA,MAClC;AAEA,aAAO,iBAAiB,UAAU;AAAA,QACjC,cAAc;AAAA,UACb,KAAK,MAAM,KAAK;AAAA,UAChB,KAAK,aAAW;AACf,iBAAK,kBAAkB;AAAA,UACxB;AAAA,QACD;AAAA,MACD,CAAC;AAED,eAAS,WAAW,UAAU,QAAQ;AAAA,IACvC,CAAC;AAAA,EACF;AAAA,EAEA,KAAK,aAAa,YAAY;AAE7B,WAAO,KAAK,SAAS,KAAK,aAAa,UAAU;AAAA,EAClD;AAAA,EAEA,MAAM,YAAY;AAEjB,WAAO,KAAK,SAAS,MAAM,UAAU;AAAA,EACtC;AAAA,EAEA,QAAQ,WAAW;AAElB,WAAO,KAAK,SAAS,QAAQ,SAAS;AAAA,EACvC;AAAA,EAEA,OAAO,QAAQ;AACd,QAAI,CAAC,KAAK,cAAc,KAAK,aAAa;AACzC;AAAA,IACD;AAEA,SAAK,cAAc;AAEnB,QAAI,KAAK,gBAAgB,SAAS,GAAG;AACpC,UAAI;AACH,mBAAW,WAAW,KAAK,iBAAiB;AAC3C,kBAAQ;AAAA,QACT;AAAA,MACD,SAAS,OAAP;AACD,aAAK,QAAQ,KAAK;AAClB;AAAA,MACD;AAAA,IACD;AAEA,QAAI,KAAK,iBAAiB;AACzB,WAAK,QAAQ,IAAI,YAAY,MAAM,CAAC;AAAA,IACrC;AAAA,EACD;AAAA,EAEA,IAAI,aAAa;AAChB,WAAO,KAAK;AAAA,EACb;AACD;AAEA,OAAO,eAAe,YAAY,WAAW,QAAQ,SAAS;",
  "names": []
}
